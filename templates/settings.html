{% extends "framework.html" %}

{% block app %}
<script type="text/javascript">

</script>
<div id="previewModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
</div>
<div class="btn-group" style="margin-bottom:10px;">
    <button class="btn btn-primary"><i class="icon-plus icon-white"></i>新建页面</button>
    <button class="btn dropdown-toggle btn-primary" data-toggle="dropdown">
        <span class="caret"></span>
    </button>

    <ul class="dropdown-menu">
        <li><a href="/content_page/add">内容页面</a></li>
        <li><a href="/link_page/add">链接页面</a></li>
    </ul>
</div>
<div>
    <ul class="nav nav-tabs" style="margin-bottom:10px">
    {% for t in tabs %}
        {% if forloop.counter0 == active_tab_id %}
        <li class='active'><a href="#">{{ t.0.tab_name }}</a></li>
        {% else %}
        <li><a href="/settings/{{ forloop.counter0 }}">{{ t.0.tab_name }}</a></li>
        {% endif %}
    {% endfor %}
    </ul>
    <form id='page_form' action="/save/{{page.pk}}/" method="post" enctype="multipart/form-data"> {% csrf_token %}
        {% include page.template_name with form=f only %}
        <div class="form-bottom-buttons text-right">
            {% if active_tab_id > 8 %}
            <a href="#delete_page" class="btn btn-danger" id="tab-delete" data-toggle="modal">删除页面</a>
            {% endif %}
            <button class="btn btn-primary" id="tab-save">保存</button>
            <button class="btn btn-primary" id="tab-preview">预览</button>
        </div>
    </form>
</div>

<div id="delete_page" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="myModalLabel">删除页面</h3>
    </div>
    <div class="modal-body">
        <p>确认删除</p><strong> {{ active_tab_name }}</strong>
    </div>
    <div class="modal-footer">
        <button id="delete_page_button" class="btn btn-danger">删除</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
    </div>
</div>

<a id="preview" href="#previewModal" style="display:none" data-toggle='modal'></a>
<script>
$('#tab-save').click(function() {
    $("#page_form").attr('action', "/save/{{page.pk}}");
    $("#page_form").attr('target', "_self");
    $(this).closest('form').submit();
});
$('#tab-preview').click(function() {
    bootbox.alert("<iframe name='iframe_preview' width='480' height='640'></iframe>");
    $("#page_form").attr('action', "/preview/page/{{page.pk}}");
    $("#page_form").attr('target', "iframe_preview");

    $("#page_form").submit();
    $('.bootbox').css('width', '520px');
    $('.modal-body').css('height', '660px');
});
</script>
{% endblock %}
